<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Items - Lost and Found</title>
    <link rel="stylesheet" th:href="@{/css/my-items.css}">
</head>
<body>
<nav>
    <div class="nav-left">
        <span class="logo">üì¶ My Items</span>
    </div>
    <div class="nav-right">
        <a th:href="@{/dashboard}">Home</a>
        <a th:href="@{/items/browse}">Browse</a>
        <a th:href="@{/messages}">Messages</a>
        <a th:href="@{/my-items}">My Items</a>

        <a th:if="${session.loggedinuser != null && session.loggedinuser.role == 'ADMIN'}"
           th:href="@{/admin}" style="color: #ffc107; font-weight: bold;">
            ‚öôÔ∏è Admin
        </a>

        <a th:href="@{/logout}">Logout</a>
    </div>
</nav>

<div class="container">
    <h1>My Items</h1>
    <p>Manage the items you have posted.</p>

    <div class="controls">
        <a th:href="@{/items/add}" class="btn btn-primary">+ Post New Item</a>
    </div>

    <table class="items-table" th:if="${items != null && !items.isEmpty()}">
        <thead>
        <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Name</th>
            <th>Date</th>
            <th>Location</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${items}">
            <td th:text="${item.itemId}">1</td>
            <!-- ‚úÖ FIXED: Use item.itemType instead of item.type -->
            <td>
                        <span class="badge"
                              th:classappend="${item.itemType == 'LOST' ? 'badge-lost' : 'badge-found'}"
                              th:text="${item.itemType}">LOST</span>
            </td>
            <td th:text="${item.itemName}">Item Name</td>
            <td th:text="${#temporals.format(item.dateLostFound, 'yyyy-MM-dd')}">2024-01-01</td>
            <td th:text="${item.location}">Location</td>
            <td>
                        <span class="badge"
                              th:classappend="${item.status == 'ACTIVE' ? 'badge-active' : 'badge-resolved'}"
                              th:text="${item.status}">ACTIVE</span>
            </td>
            <td class="actions">
                <a th:href="@{/items/{id}(id=${item.itemId})}" class="btn btn-sm">View</a>
                <a th:href="@{/items/edit/{id}(id=${item.itemId})}" class="btn btn-sm btn-secondary">Edit</a>

                <form th:if="${item.status == 'ACTIVE'}"
                      th:action="@{/items/resolve/{id}(id=${item.itemId})}"
                      method="post" style="display: inline;">
                    <button type="submit" class="btn btn-sm btn-success">Resolve</button>
                </form>

                <form th:action="@{/items/delete/{id}(id=${item.itemId})}"
                      method="post"
                      onsubmit="return confirm('Are you sure you want to delete this item?');"
                      style="display: inline;">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:if="${items == null || items.isEmpty()}" class="no-items">
        <p>You haven't posted any items yet.</p>
        <a th:href="@{/items/add}" class="btn btn-primary">Post Your First Item</a>
    </div>
</div>

<script th:src="@{/js/my-items.js}"></script>
</body>
</html>

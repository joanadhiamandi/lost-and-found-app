<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${item.itemName} + ' - Lost and Found'">Item Detail</title>
    <link rel="stylesheet" th:href="@{/css/item-detail.css}">
</head>
<body>
<nav>
    <div class="nav-left">
        <span class="logo">ğŸ“¦ Item Details</span>
    </div>
    <div class="nav-right">
        <a th:href="@{/dashboard}">Home</a>
        <a th:href="@{/items/browse}">Browse</a>
        <a th:href="@{/messages}">Messages</a>
        <a th:href="@{/my-items}">My Items</a>

        <a th:if="${session.loggedinuser != null && session.loggedinuser.role == 'ADMIN'}"
           th:href="@{/admin}" style="color: #ffc107; font-weight: bold;">
            âš™ï¸ Admin
        </a>

        <a th:href="@{/logout}">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="item-card">
        <h1 th:text="${item.itemName}">Item Name</h1>

        <div class="item-meta">
            <!-- âœ… FIXED: Use itemType instead of type -->
            <span class="badge"
                  th:classappend="${item.itemType == 'LOST' ? 'badge-lost' : 'badge-found'}"
                  th:text="${item.itemType}">LOST</span>

            <span class="badge"
                  th:classappend="${item.status == 'ACTIVE' ? 'badge-active' : 'badge-resolved'}"
                  th:text="${item.status}">ACTIVE</span>
        </div>

        <div class="item-info">
            <p><strong>Category:</strong> <span th:text="${item.category.categoryName}">Category</span></p>
            <p><strong>Location:</strong> <span th:text="${item.location}">Location</span></p>
            <p><strong>Date:</strong> <span th:text="${#temporals.format(item.dateLostFound, 'dd MMM yyyy')}">Date</span></p>
            <p><strong>Posted by:</strong> <span th:text="${item.user.fullName}">User</span></p>
            <p><strong>Contact:</strong> <span th:text="${item.contactInfo}">Contact</span></p>
        </div>

        <div class="item-description">
            <h3>Description</h3>
            <p th:text="${item.description}">Description</p>
        </div>

        <div class="action-buttons">
            <a th:if="${session.loggedinuser.userId == item.user.userId}"
               th:href="@{/items/edit/{id}(id=${item.itemId})}"
               class="btn btn-secondary">
                ğŸ–Šï¸ Edit
            </a>

            <form th:if="${session.loggedinuser.userId == item.user.userId && item.status == 'ACTIVE'}"
                  th:action="@{/items/resolve/{id}(id=${item.itemId})}"
                  method="post" style="display: inline;">
                <button type="submit" class="btn btn-success">âœ… Mark Resolved</button>
            </form>

            <button th:if="${session.loggedinuser.userId != item.user.userId}"
                    id="messageBtn"
                    th:attr="data-item-id=${item.itemId}"
                    class="btn btn-primary">
                ğŸ’¬ Message Owner
            </button>

            <button id="copyLinkBtn" class="btn btn-secondary">ğŸ”— Copy Link</button>

            <form th:if="${session.loggedinuser.role == 'ADMIN'}"
                  th:action="@{/admin/delete-item}"
                  method="post"
                  onsubmit="return confirm('Are you sure you want to delete this item?');"
                  style="display: inline;">
                <input type="hidden" name="itemId" th:value="${item.itemId}">
                <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Delete (Admin)</button>
            </form>
        </div>
    </div>
</div>

<div id="messageModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ğŸ’¬ Send Message</h2>
            <button type="button" class="close-btn" onclick="closeMessageModal()">&times;</button>
        </div>
        <div class="modal-body">
                <textarea id="messageInput"
                          placeholder="Type your message here..."
                          maxlength="1000"></textarea>
            <div class="char-count" id="charCount">0/1000</div>
            <div class="error-message" id="modalError"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeMessageModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="sendMessageFromModal()">Send</button>
        </div>
    </div>
</div>

<script th:src="@{/js/item-detail.js}"></script>
</body>
</html>
